import React, { useState, useEffect } from 'react'; import { supabase } from '@/api/supabaseClient'; import { useAuth } from '@/lib/AuthContext'; import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card"; import { Button } from "@/components/ui/button"; import { Input } from "@/components/ui/input"; import { Label } from "@/components/ui/label"; import { Save, Loader2, ExternalLink } from 'lucide-react';  export default function IntegrationsTab() {   const { user } = useAuth();   const [apiKey, setApiKey] = useState('');   const [apiSecret, setApiSecret] = useState('');   const [loading, setLoading] = useState(true);   const [saving, setSaving] = useState(false);    useEffect(() => {     if (!user) return;     loadConfig();   }, [user]);    const loadConfig = async () => {     if (!user) return;     try {       // DB impact: none (UI localization only; schema and query shape unchanged).       const { data, error } = await supabase         .from('app_configs')         .select('config_data')         .eq('owner_id', user.id)         .eq('config_type', 'greeninvoice_api')         .limit(1)         .maybeSingle();       if (error) throw error;       if (data) {         setApiKey(data.config_data?.api_key || '');         setApiSecret(data.config_data?.api_secret || '');       }     } catch (error) {       console.error('Error loading config:', error);     } finally {       setLoading(false);     }   };    const saveConfig = async () => {     if (!user) return;     setSaving(true);     try {       const configData = {         config_type: 'greeninvoice_api',         config_data: {           api_key: apiKey,           api_secret: apiSecret         },         is_active: true       };        const { error } = await supabase         .from('app_configs')         .upsert([{ ...configData, owner_id: user.id }], { onConflict: 'owner_id,config_type' });       if (error) throw error;     } catch (error) {       console.error('Error saving config:', error);     } finally {       setSaving(false);     }   };    if (loading) {     return (       <div className="flex justify-center py-12">         <Loader2 className="w-8 h-8 text-emerald-500 animate-spin" />       </div>     );   }    return (     <div className="space-y-6">       <Card className="border-0 shadow-sm">         <CardHeader>           <div className="flex items-center justify-between">             <div>               <CardTitle className="text-lg">חשבונית ירוקה (GreenInvoice)</CardTitle>               <CardDescription>חיבור למערכת חשבונית ירוקה להנפקת חשבוניות אוטומטית</CardDescription>             </div>             <a               href="https://app.greeninvoice.co.il/settings/api"               target="_blank"               rel="noopener noreferrer"               className="text-emerald-600 hover:text-emerald-700 flex items-center gap-1 text-sm"             >ניהול מפתחות API               <ExternalLink className="w-3 h-3" />             </a>           </div>         </CardHeader>         <CardContent className="space-y-4">           <div className="space-y-2">             <Label htmlFor="api_key">מפתח API</Label>             <Input               id="api_key"               type="password"               value={apiKey}               onChange={(e) => setApiKey(e.target.value)}               placeholder="הזן את מפתח ה-API כאן"               dir="ltr"             />           </div>            <div className="space-y-2">             <Label htmlFor="api_secret">סוד API</Label>             <Input               id="api_secret"               type="password"               value={apiSecret}               onChange={(e) => setApiSecret(e.target.value)}               placeholder="הזן את סוד ה-API כאן"               dir="ltr"             />           </div>            <Button             onClick={saveConfig}             disabled={saving || !apiKey || !apiSecret}             style={{ backgroundColor: '#00214d' }}             className="hover:opacity-90"           >             {saving ? <Loader2 className="w-4 h-4 ml-2 animate-spin" /> : <Save className="w-4 h-4 ml-2" />}             שמור הגדרות           </Button>         </CardContent>       </Card>        <Card className="border-0 shadow-sm bg-blue-50 border-blue-200">         <CardContent className="p-4">           <h4 className="font-semibold text-blue-900 mb-2">איך זה עובד?</h4>           <ul className="text-sm text-blue-800 space-y-1">             <li>• בסיום עבודה, לחץ על "הוצא חשבונית" בפרטי העבודה</li>             <li>• המערכת תיצור חשבונית אוטומטית בחשבונית ירוקה</li>             <li>• פרטי הלקוח והעבודה יועברו אוטומטית</li>             <li>• תוכל לעקוב אחר סטטוס התשלום במערכת</li>           </ul>         </CardContent>       </Card>     </div>   ); }


